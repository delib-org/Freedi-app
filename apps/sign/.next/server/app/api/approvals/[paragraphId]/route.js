"use strict";(()=>{var e={};e.id=63,e.ids=[63],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},3263:e=>{e.exports=import("firebase-admin/app")},2929:e=>{e.exports=import("firebase-admin/firestore")},8862:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{originalPathname:()=>E,patchFetch:()=>l,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>I,staticGenerationAsyncStorage:()=>d});var o=t(9303),a=t(8716),s=t(670),i=t(6686),p=e([i]);i=(p.then?(await p)():p)[0];let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/approvals/[paragraphId]/route",pathname:"/api/approvals/[paragraphId]",filename:"route",bundlePath:"app/api/approvals/[paragraphId]/route"},resolvedPagePath:"/Users/talyaron/Documents/Freedi-app/apps/sign/app/api/approvals/[paragraphId]/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:I}=c,E="/api/approvals/[paragraphId]/route";function l(){return(0,s.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:d})}n()}catch(e){n(e)}})},6686:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{DELETE:()=>u,GET:()=>l,POST:()=>c});var o=t(7070),a=t(6128),s=t(5734),i=t(5697),p=e([a]);async function l(e,{params:r}){try{let{paragraphId:t}=await r,n=(0,s.ld)(e.headers.get("cookie"));if(!n)return o.NextResponse.json({error:"User not authenticated"},{status:401});let p=(0,a.Rx)(),l=`${n}--${t}`,c=await p.collection(i.nW.approval).doc(l).get();if(!c.exists)return o.NextResponse.json({approval:null});return o.NextResponse.json({approval:c.data()})}catch(e){return console.error("[Approvals API] GET error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e,{params:r}){try{let{paragraphId:t}=await r,n=(0,s.ld)(e.headers.get("cookie"));if(!n)return o.NextResponse.json({error:"User not authenticated"},{status:401});let{approval:p,documentId:l}=await e.json();if("boolean"!=typeof p)return o.NextResponse.json({error:"Approval must be a boolean"},{status:400});if(!l)return o.NextResponse.json({error:"documentId is required"},{status:400});let c=(0,a.Rx)(),u=`${n}--${t}`,d=await c.collection(i.nW.statements).doc(t).get(),I=d.exists?d.data():null,E={approvalId:u,statementId:t,documentId:l,topParentId:I?.topParentId||l,userId:n,approval:p,createdAt:Date.now()};return await c.collection(i.nW.approval).doc(u).set(E),console.info(`[Approvals API] Created/updated approval: ${u} - ${p}`),o.NextResponse.json({success:!0,approval:E})}catch(e){return console.error("[Approvals API] POST error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function u(e,{params:r}){try{let{paragraphId:t}=await r,n=(0,s.ld)(e.headers.get("cookie"));if(!n)return o.NextResponse.json({error:"User not authenticated"},{status:401});let p=(0,a.Rx)(),l=`${n}--${t}`;return await p.collection(i.nW.approval).doc(l).delete(),console.info(`[Approvals API] Deleted approval: ${l}`),o.NextResponse.json({success:!0})}catch(e){return console.error("[Approvals API] DELETE error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}a=(p.then?(await p)():p)[0],n()}catch(e){n(e)}})},5697:(e,r,t)=>{t.d(r,{nW:()=>n.nW});var n=t(3704)},6128:(e,r,t)=>{t.a(e,async(e,n)=>{try{let c,u;t.d(r,{IW:()=>l,Rx:()=>p});var o=t(3263),a=t(2929),s=e([o,a]);function i(){if((0,o.getApps)().length>0)return c=(0,o.getApps)()[0];try{let e=process.env.FIREBASE_CLIENT_EMAIL&&process.env.FIREBASE_PRIVATE_KEY,r=process.env.GOOGLE_APPLICATION_CREDENTIALS;if(e)c=(0,o.initializeApp)({credential:(0,o.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")}),projectId:process.env.FIREBASE_PROJECT_ID}),console.info("[Firebase Admin - Sign] Initialized with explicit credentials");else if(r){let e=t(2048),n=JSON.parse(e.readFileSync(r,"utf8"));c=(0,o.initializeApp)({credential:(0,o.cert)(n),projectId:n.project_id}),console.info("[Firebase Admin - Sign] Initialized with service account file")}else c=(0,o.initializeApp)({projectId:process.env.FIREBASE_PROJECT_ID}),console.info("[Firebase Admin - Sign] Initialized with default credentials");return c}catch(e){throw console.error("[Firebase Admin - Sign] Initialization failed:",e),e}}function p(){if(!u){c||i(),u=(0,a.getFirestore)(c);let e=process.env.FIRESTORE_EMULATOR_HOST;e?console.info("[Firebase Admin - Sign] Connected to Firestore emulator:",e):console.info("[Firebase Admin - Sign] Connected to production Firestore")}return u}function l(){return c||i(),{db:p(),app:c}}[o,a]=s.then?(await s)():s,"true"===process.env.USE_FIREBASE_EMULATOR&&process.env.FIRESTORE_EMULATOR_HOST&&(process.env.FIRESTORE_EMULATOR_HOST=process.env.FIRESTORE_EMULATOR_HOST),n()}catch(e){n(e)}})},5734:(e,r,t)=>{function n(e){if(!e)return null;let r=e.match(/userId=([^;]+)/);return r?r[1]:null}function o(e){if(!e)return null;let r=e.match(/userDisplayName=([^;]+)/);return r?decodeURIComponent(r[1]):null}function a(e){let r=e.match(/anon_(\d+)_/);if(r){let e=parseInt(r[1]);return`User ${e.toString().slice(-6)}`}return"Anonymous User"}function s(e){let r=function(e){let r=e.get("userId");return r?.value??null}(e);if(!r)return null;let t=e.get("userDisplayName"),n=t?.value?decodeURIComponent(t.value):a(r);return{uid:r,displayName:n,isAnonymous:r.startsWith("anon_")}}t.d(r,{BD:()=>o,CV:()=>a,N5:()=>s,ld:()=>n})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[380,704,972],()=>t(8862));module.exports=n})();