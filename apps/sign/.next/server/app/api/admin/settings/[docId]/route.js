"use strict";(()=>{var e={};e.id=354,e.ids=[354],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},3263:e=>{e.exports=import("firebase-admin/app")},2929:e=>{e.exports=import("firebase-admin/firestore")},8922:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{originalPathname:()=>g,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var s=n(9303),o=n(8716),i=n(670),a=n(9636),l=e([a]);a=(l.then?(await l)():l)[0];let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/settings/[docId]/route",pathname:"/api/admin/settings/[docId]",filename:"route",bundlePath:"app/api/admin/settings/[docId]/route"},resolvedPagePath:"/Users/talyaron/Documents/Freedi-app/apps/sign/app/api/admin/settings/[docId]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m}=c,g="/api/admin/settings/[docId]/route";function u(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}r()}catch(e){r(e)}})},9636:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{GET:()=>u,PUT:()=>c});var s=n(7070),o=n(6128),i=n(5734),a=n(5697),l=e([o]);o=(l.then?(await l)():l)[0];let d={allowComments:!0,allowApprovals:!0,requireLogin:!1,showHeatMap:!0,showViewCounts:!0,isPublic:!0};async function u(e,{params:t}){try{let{docId:n}=await t,r=(0,i.ld)(e.headers.get("cookie"));if(!r)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{db:l}=(0,o.IW)(),u=l.collection(a.nW.statements).doc(n),c=await u.get();if(!c.exists)return s.NextResponse.json({error:"Document not found"},{status:404});let p=c.data();if(!(p?.creator?.odlUserId===r||p?.creatorId===r))return s.NextResponse.json({error:"Forbidden - Admin access required"},{status:403});let m={allowComments:p?.signSettings?.allowComments??d.allowComments,allowApprovals:p?.signSettings?.allowApprovals??d.allowApprovals,requireLogin:p?.signSettings?.requireLogin??d.requireLogin,showHeatMap:p?.signSettings?.showHeatMap??d.showHeatMap,showViewCounts:p?.signSettings?.showViewCounts??d.showViewCounts,isPublic:p?.signSettings?.isPublic??d.isPublic};return s.NextResponse.json(m)}catch(e){return console.error("[API] Admin settings GET failed:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e,{params:t}){try{let{docId:n}=await t,r=(0,i.ld)(e.headers.get("cookie"));if(!r)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{db:l}=(0,o.IW)(),u=l.collection(a.nW.statements).doc(n),c=await u.get();if(!c.exists)return s.NextResponse.json({error:"Document not found"},{status:404});let d=c.data();if(!(d?.creator?.odlUserId===r||d?.creatorId===r))return s.NextResponse.json({error:"Forbidden - Admin access required"},{status:403});let p=await e.json(),m={allowComments:!!p.allowComments,allowApprovals:!!p.allowApprovals,requireLogin:!!p.requireLogin,showHeatMap:!!p.showHeatMap,showViewCounts:!!p.showViewCounts,isPublic:!!p.isPublic};return await u.update({signSettings:m,lastUpdate:Date.now()}),console.info(`[API] Settings updated for document ${n} by user ${r}`),s.NextResponse.json({success:!0,settings:m})}catch(e){return console.error("[API] Admin settings PUT failed:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}r()}catch(e){r(e)}})},5697:(e,t,n)=>{n.d(t,{nW:()=>r.nW});var r=n(3704)},6128:(e,t,n)=>{n.a(e,async(e,r)=>{try{let c,d;n.d(t,{IW:()=>u,Rx:()=>l});var s=n(3263),o=n(2929),i=e([s,o]);function a(){if((0,s.getApps)().length>0)return c=(0,s.getApps)()[0];try{let e=process.env.FIREBASE_CLIENT_EMAIL&&process.env.FIREBASE_PRIVATE_KEY,t=process.env.GOOGLE_APPLICATION_CREDENTIALS;if(e)c=(0,s.initializeApp)({credential:(0,s.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")}),projectId:process.env.FIREBASE_PROJECT_ID}),console.info("[Firebase Admin - Sign] Initialized with explicit credentials");else if(t){let e=n(2048),r=JSON.parse(e.readFileSync(t,"utf8"));c=(0,s.initializeApp)({credential:(0,s.cert)(r),projectId:r.project_id}),console.info("[Firebase Admin - Sign] Initialized with service account file")}else c=(0,s.initializeApp)({projectId:process.env.FIREBASE_PROJECT_ID}),console.info("[Firebase Admin - Sign] Initialized with default credentials");return c}catch(e){throw console.error("[Firebase Admin - Sign] Initialization failed:",e),e}}function l(){if(!d){c||a(),d=(0,o.getFirestore)(c);let e=process.env.FIRESTORE_EMULATOR_HOST;e?console.info("[Firebase Admin - Sign] Connected to Firestore emulator:",e):console.info("[Firebase Admin - Sign] Connected to production Firestore")}return d}function u(){return c||a(),{db:l(),app:c}}[s,o]=i.then?(await i)():i,"true"===process.env.USE_FIREBASE_EMULATOR&&process.env.FIRESTORE_EMULATOR_HOST&&(process.env.FIRESTORE_EMULATOR_HOST=process.env.FIRESTORE_EMULATOR_HOST),r()}catch(e){r(e)}})},5734:(e,t,n)=>{function r(e){if(!e)return null;let t=e.match(/userId=([^;]+)/);return t?t[1]:null}function s(e){if(!e)return null;let t=e.match(/userDisplayName=([^;]+)/);return t?decodeURIComponent(t[1]):null}function o(e){let t=e.match(/anon_(\d+)_/);if(t){let e=parseInt(t[1]);return`User ${e.toString().slice(-6)}`}return"Anonymous User"}function i(e){let t=function(e){let t=e.get("userId");return t?.value??null}(e);if(!t)return null;let n=e.get("userDisplayName"),r=n?.value?decodeURIComponent(n.value):o(t);return{uid:t,displayName:r,isAnonymous:t.startsWith("anon_")}}n.d(t,{BD:()=>s,CV:()=>o,N5:()=>i,ld:()=>r})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[380,704,972],()=>n(8922));module.exports=r})();