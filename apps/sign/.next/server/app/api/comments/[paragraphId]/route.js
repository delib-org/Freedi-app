"use strict";(()=>{var e={};e.id=891,e.ids=[891],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},3263:e=>{e.exports=import("firebase-admin/app")},2929:e=>{e.exports=import("firebase-admin/firestore")},7509:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>u,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s=r(9303),o=r(8716),a=r(670),i=r(2509),c=e([i]);i=(c.then?(await c)():c)[0];let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/comments/[paragraphId]/route",pathname:"/api/comments/[paragraphId]",filename:"route",bundlePath:"app/api/comments/[paragraphId]/route"},resolvedPagePath:"/Users/talyaron/Documents/Freedi-app/apps/sign/app/api/comments/[paragraphId]/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:m}=p,I="/api/comments/[paragraphId]/route";function u(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}n()}catch(e){n(e)}})},2509:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{DELETE:()=>l,GET:()=>u,POST:()=>p});var s=r(7070),o=r(6128),a=r(5734),i=r(1433),c=e([o]);async function u(e,{params:t}){try{let{paragraphId:e}=await t,r=(0,o.Rx)(),n=(await r.collection(i.nW.statements).where("parentId","==",e).where("statementType","==",i.ur.statement).orderBy("createdAt","asc").limit(100).get()).docs.map(e=>e.data()).filter(e=>!e.hide);return s.NextResponse.json({comments:n})}catch(e){return console.error("[Comments API] GET error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e,{params:t}){try{let{paragraphId:r}=await t,n=e.headers.get("cookie"),c=(0,a.ld)(n);if(!c)return s.NextResponse.json({error:"User not authenticated"},{status:401});let{statement:u,documentId:p}=await e.json();if(!u||0===u.trim().length)return s.NextResponse.json({error:"Comment text is required"},{status:400});if(!p)return s.NextResponse.json({error:"documentId is required"},{status:400});let l=(0,o.Rx)(),d=(0,a.BD)(n)||(0,a.CV)(c),m=`${c}--${Date.now()}--${Math.random().toString(36).substring(2,9)}`,I={statementId:m,statement:u.trim(),statementType:i.ur.statement,parentId:r,paragraphId:r,topParentId:p,documentId:p,creatorId:c,creator:{displayName:d,uid:c},createdAt:Date.now(),lastUpdate:Date.now(),consensus:0,hide:!1};return await l.collection(i.nW.statements).doc(m).set(I),console.info(`[Comments API] Created comment: ${m}`),s.NextResponse.json({success:!0,comment:I})}catch(e){return console.error("[Comments API] POST error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e,{params:t}){try{await t;let r=(0,a.ld)(e.headers.get("cookie"));if(!r)return s.NextResponse.json({error:"User not authenticated"},{status:401});let{commentId:n}=await e.json();if(!n)return s.NextResponse.json({error:"commentId is required"},{status:400});let c=(0,o.Rx)(),u=await c.collection(i.nW.statements).doc(n).get();if(!u.exists)return s.NextResponse.json({error:"Comment not found"},{status:404});let p=u.data();if(p?.creatorId!==r)return s.NextResponse.json({error:"Not authorized to delete this comment"},{status:403});return await c.collection(i.nW.statements).doc(n).update({hide:!0,lastUpdate:Date.now()}),console.info(`[Comments API] Deleted comment: ${n}`),s.NextResponse.json({success:!0})}catch(e){return console.error("[Comments API] DELETE error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}o=(c.then?(await c)():c)[0],n()}catch(e){n(e)}})},1433:(e,t,r)=>{r.d(t,{nW:()=>n.nW,ur:()=>n.ur});var n=r(3704)},6128:(e,t,r)=>{r.a(e,async(e,n)=>{try{let p,l;r.d(t,{IW:()=>u,Rx:()=>c});var s=r(3263),o=r(2929),a=e([s,o]);function i(){if((0,s.getApps)().length>0)return p=(0,s.getApps)()[0];try{let e=process.env.FIREBASE_CLIENT_EMAIL&&process.env.FIREBASE_PRIVATE_KEY,t=process.env.GOOGLE_APPLICATION_CREDENTIALS;if(e)p=(0,s.initializeApp)({credential:(0,s.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")}),projectId:process.env.FIREBASE_PROJECT_ID}),console.info("[Firebase Admin - Sign] Initialized with explicit credentials");else if(t){let e=r(2048),n=JSON.parse(e.readFileSync(t,"utf8"));p=(0,s.initializeApp)({credential:(0,s.cert)(n),projectId:n.project_id}),console.info("[Firebase Admin - Sign] Initialized with service account file")}else p=(0,s.initializeApp)({projectId:process.env.FIREBASE_PROJECT_ID}),console.info("[Firebase Admin - Sign] Initialized with default credentials");return p}catch(e){throw console.error("[Firebase Admin - Sign] Initialization failed:",e),e}}function c(){if(!l){p||i(),l=(0,o.getFirestore)(p);let e=process.env.FIRESTORE_EMULATOR_HOST;e?console.info("[Firebase Admin - Sign] Connected to Firestore emulator:",e):console.info("[Firebase Admin - Sign] Connected to production Firestore")}return l}function u(){return p||i(),{db:c(),app:p}}[s,o]=a.then?(await a)():a,"true"===process.env.USE_FIREBASE_EMULATOR&&process.env.FIRESTORE_EMULATOR_HOST&&(process.env.FIRESTORE_EMULATOR_HOST=process.env.FIRESTORE_EMULATOR_HOST),n()}catch(e){n(e)}})},5734:(e,t,r)=>{function n(e){if(!e)return null;let t=e.match(/userId=([^;]+)/);return t?t[1]:null}function s(e){if(!e)return null;let t=e.match(/userDisplayName=([^;]+)/);return t?decodeURIComponent(t[1]):null}function o(e){let t=e.match(/anon_(\d+)_/);if(t){let e=parseInt(t[1]);return`User ${e.toString().slice(-6)}`}return"Anonymous User"}function a(e){let t=function(e){let t=e.get("userId");return t?.value??null}(e);if(!t)return null;let r=e.get("userDisplayName"),n=r?.value?decodeURIComponent(r.value):o(t);return{uid:t,displayName:n,isAnonymous:t.startsWith("anon_")}}r.d(t,{BD:()=>s,CV:()=>o,N5:()=>a,ld:()=>n})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[380,704,972],()=>r(7509));module.exports=n})();