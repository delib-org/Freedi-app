(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[410],{3107:function(e,t,a){Promise.resolve().then(a.bind(a,61)),Promise.resolve().then(a.t.bind(a,1407,23)),Promise.resolve().then(a.bind(a,4522))},61:function(e,t,a){"use strict";a.d(t,{default:function(){return g}});var n=a(7437),o=a(2265),r=a(646),s=a(5790),i=a.n(s);function c(e){let{title:t,onClose:a,children:r,size:s="medium"}=e,c=(0,o.useCallback)(e=>{"Escape"===e.key&&a()},[a]);return(0,o.useEffect)(()=>(document.addEventListener("keydown",c),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",c),document.body.style.overflow=""}),[c]),(0,n.jsx)("div",{className:i().backdrop,onClick:e=>{e.target===e.currentTarget&&a()},role:"dialog","aria-modal":"true","aria-labelledby":t?"modal-title":void 0,children:(0,n.jsxs)("div",{className:"".concat(i().modal," ").concat(i()[s]),children:[t&&(0,n.jsxs)("header",{className:i().header,children:[(0,n.jsx)("h2",{id:"modal-title",className:i().title,children:t}),(0,n.jsx)("button",{type:"button",className:i().closeButton,onClick:a,"aria-label":"Close modal",children:(0,n.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,n.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,n.jsx)("div",{className:i().content,children:r})]})})}var l=a(4111),d=a(6082),m=a.n(d);function _(e){var t,a,o;let{comment:r,onDelete:s}=e,{t:i}=(0,l.$G)();return(0,n.jsxs)("article",{className:m().comment,children:[(0,n.jsxs)("header",{className:m().header,children:[(0,n.jsx)("div",{className:m().avatar,children:(null===(a=r.creator)||void 0===a?void 0:null===(t=a.displayName)||void 0===t?void 0:t.charAt(0).toUpperCase())||"?"}),(0,n.jsxs)("div",{className:m().meta,children:[(0,n.jsx)("span",{className:m().author,children:(null===(o=r.creator)||void 0===o?void 0:o.displayName)||i("Anonymous")}),(0,n.jsx)("span",{className:m().date,children:(e=>{let t=new Date(e),a=new Date().getTime()-t.getTime(),n=Math.floor(a/6e4),o=Math.floor(a/36e5),r=Math.floor(a/864e5);return n<1?i("Just now"):n<60?"".concat(n," ").concat(i("minutes ago")):o<24?"".concat(o," ").concat(i("hours ago")):r<7?"".concat(r," ").concat(i("days ago")):t.toLocaleDateString()})(r.createdAt)})]}),!1]}),(0,n.jsx)("p",{className:m().content,children:r.statement})]})}var u=a(5245),h=a.n(u);function p(e){let{paragraphId:t,documentId:a,isLoggedIn:r}=e,{t:s}=(0,l.$G)(),[i,c]=(0,o.useState)([]),[d,m]=(0,o.useState)(!0),[u,p]=(0,o.useState)(!1),[g,x]=(0,o.useState)(""),[v,j]=(0,o.useState)(null),f=(0,o.useCallback)(async()=>{try{m(!0);let e=await fetch("/api/comments/".concat(t));if(e.ok){let t=await e.json();c(t.comments||[])}else console.error("Failed to fetch comments")}catch(e){console.error("Error fetching comments:",e)}finally{m(!1)}},[t]);(0,o.useEffect)(()=>{f()},[f]);let y=async e=>{if(e.preventDefault(),g.trim()&&r){p(!0),j(null);try{let e=await fetch("/api/comments/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({statement:g.trim(),documentId:a})});if(e.ok){let t=await e.json();c(e=>[...e,t.comment]),x("")}else{let t=await e.json();j(t.error||"Failed to post comment")}}catch(e){console.error("Error posting comment:",e),j("Failed to post comment. Please try again.")}finally{p(!1)}}},C=async e=>{try{(await fetch("/api/comments/".concat(t),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({commentId:e})})).ok?c(t=>t.filter(t=>t.statementId!==e)):console.error("Failed to delete comment")}catch(e){console.error("Error deleting comment:",e)}};return(0,n.jsxs)("div",{className:h().container,children:[(0,n.jsx)("div",{className:h().list,children:d?(0,n.jsxs)("div",{className:h().loading,children:[(0,n.jsx)("div",{className:"skeleton",style:{height:"60px",marginBottom:"8px"}}),(0,n.jsx)("div",{className:"skeleton",style:{height:"60px",marginBottom:"8px"}})]}):0===i.length?(0,n.jsx)("p",{className:h().empty,children:s("No comments yet")}):i.map(e=>(0,n.jsx)(_,{comment:e,onDelete:C},e.statementId))}),r?(0,n.jsxs)("form",{className:h().form,onSubmit:y,children:[(0,n.jsx)("textarea",{className:h().textarea,value:g,onChange:e=>x(e.target.value),placeholder:s("Add a comment..."),rows:3,disabled:u}),v&&(0,n.jsx)("p",{className:h().error,children:v}),(0,n.jsx)("button",{type:"submit",className:h().submitButton,disabled:u||!g.trim(),children:s(u?"Posting...":"Post Comment")})]}):(0,n.jsx)("p",{className:h().loginPrompt,children:s("Please log in to add comments")})]})}function g(e){let{documentId:t,user:a,userSignature:s,children:i}=e,{activeModal:l,modalContext:d,closeModal:m,setSubmitting:_}=(0,r.HB)(),u=(0,o.useCallback)(async e=>{if(!a){window.location.href="/login?redirect=/doc/".concat(t);return}_(!0);try{let a=await fetch("/api/signatures/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signed:"sign"===e?"signed":"rejected"})});if(a.ok)window.location.reload();else{let e=await a.json();console.error("Failed to submit signature:",e),alert("Failed to submit. Please try again.")}}catch(e){console.error("Error submitting signature:",e),alert("Failed to submit. Please try again.")}finally{_(!1)}},[t,a,_]);return(0,o.useEffect)(()=>{let e=e=>{var t;let a=null===(t=e.target.closest("[data-action]"))||void 0===t?void 0:t.getAttribute("data-action");("sign"===a||"reject"===a)&&u(a)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[u]),(0,o.useEffect)(()=>{a&&!s&&fetch("/api/signatures/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signed:"viewed"})}).catch(console.error)},[t,a,s]),(0,n.jsxs)(n.Fragment,{children:[i,"comments"===l&&(null==d?void 0:d.paragraphId)&&(0,n.jsx)(c,{title:"Comments",onClose:m,size:"large",children:(0,n.jsx)(p,{paragraphId:d.paragraphId,documentId:t,isLoggedIn:!!a})}),"signature"===l&&(0,n.jsx)(c,{title:"Confirm Signature",onClose:m,children:(0,n.jsx)("p",{children:"Are you sure you want to sign this document?"})})]})}},4522:function(e,t,a){"use strict";a.d(t,{default:function(){return u}});var n=a(7437),o=a(4690),r=a(1994),s=a(2265),i=a(646),c=a(5985),l=a.n(c);function d(e){let{paragraphId:t,documentId:a,isApproved:o,isLoggedIn:r,commentCount:c}=e,[d,m]=(0,s.useState)(!1),[_,u]=(0,s.useState)(o),{openModal:h}=(0,i.HB)(),p=(0,s.useCallback)(async e=>{if(!r){window.location.href="/login?redirect=/doc/".concat(a);return}u(e),m(!0);try{let n=await fetch("/api/approvals/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({approval:e,documentId:a})});if(!n.ok){u(o);let e=await n.json();console.error("Failed to submit approval:",e)}}catch(e){u(o),console.error("Error submitting approval:",e)}finally{m(!1)}},[t,a,r,o]),g=void 0!==_?_:o;return(0,n.jsxs)("div",{className:l().bar,children:[(0,n.jsxs)("div",{className:l().approvalButtons,children:[(0,n.jsxs)("button",{type:"button",className:"".concat(l().button," ").concat(l().approveButton," ").concat(!0===g?l().active:""),onClick:()=>p(!0),disabled:d,"aria-pressed":!0===g,title:"Approve",children:[(0,n.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("polyline",{points:"20 6 9 17 4 12"})}),(0,n.jsx)("span",{className:l().buttonText,children:"Approve"})]}),(0,n.jsxs)("button",{type:"button",className:"".concat(l().button," ").concat(l().rejectButton," ").concat(!1===g?l().active:""),onClick:()=>p(!1),disabled:d,"aria-pressed":!1===g,title:"Reject",children:[(0,n.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,n.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),(0,n.jsx)("span",{className:l().buttonText,children:"Reject"})]})]}),(0,n.jsxs)("button",{type:"button",className:"".concat(l().button," ").concat(l().commentButton),onClick:()=>{h("comments",{paragraphId:t})},title:"Comments",children:[(0,n.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),c>0&&(0,n.jsx)("span",{className:l().commentCount,children:c})]})]})}var m=a(2603),_=a.n(m);function u(e){let{paragraph:t,isApproved:a,isLoggedIn:s,heatLevel:i,viewCount:c,isAdmin:l}=e,m=t.paragraphType||o.NJ.paragraph,u=void 0===a?"pending":a?"approved":"rejected",h=(0,r.Z)(_().card,_()["type-".concat(m)],_()[u],i&&_()["heat-".concat(i)]);return(0,n.jsxs)("article",{id:"paragraph-".concat(t.statementId),className:h,children:[(()=>{let e=t.statement;switch(m){case o.NJ.h1:return(0,n.jsx)("h1",{className:_().content,children:e});case o.NJ.h2:return(0,n.jsx)("h2",{className:_().content,children:e});case o.NJ.h3:return(0,n.jsx)("h3",{className:_().content,children:e});case o.NJ.h4:return(0,n.jsx)("h4",{className:_().content,children:e});case o.NJ.h5:return(0,n.jsx)("h5",{className:_().content,children:e});case o.NJ.h6:return(0,n.jsx)("h6",{className:_().content,children:e});case o.NJ.li:return(0,n.jsxs)("div",{className:_().listItem,children:[(0,n.jsx)("span",{className:_().bullet,children:"â€¢"}),(0,n.jsx)("p",{className:_().content,children:e})]});default:return(0,n.jsx)("p",{className:_().content,children:e})}})(),(0,n.jsx)(d,{paragraphId:t.statementId,documentId:t.topParentId,isApproved:a,isLoggedIn:s,commentCount:0}),l&&void 0!==c&&(0,n.jsxs)("div",{className:_().adminInfo,children:[(0,n.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,n.jsx)("circle",{cx:"12",cy:"12",r:"3"})]}),(0,n.jsx)("span",{children:c})]})]})}},646:function(e,t,a){"use strict";a.d(t,{HB:function(){return n}});let n=(0,a(9625).Ue)(e=>({activeModal:null,modalContext:null,openModal:(t,a)=>e({activeModal:t,modalContext:null!=a?a:null}),closeModal:()=>e({activeModal:null,modalContext:null}),isEditMode:!1,setEditMode:t=>e({isEditMode:t}),viewMode:"default",setViewMode:t=>e({viewMode:t}),isTocExpanded:!1,toggleToc:()=>e(e=>({isTocExpanded:!e.isTocExpanded})),setTocExpanded:t=>e({isTocExpanded:t}),activeParagraphId:null,setActiveParagraphId:t=>e({activeParagraphId:t}),isSubmitting:!1,setSubmitting:t=>e({isSubmitting:t})}))},4111:function(e,t,a){"use strict";a.d(t,{$G:function(){return n.useTranslation}}),a(6810),a(5334),a(1288);var n=a(4566)},6082:function(e){e.exports={comment:"Comment_comment__VShlm",header:"Comment_header__8o7XI",avatar:"Comment_avatar__L15mg",meta:"Comment_meta__6_bC3",author:"Comment_author__P_20E",date:"Comment_date__8Tvwq",deleteButton:"Comment_deleteButton___DSFa",content:"Comment_content__b2CfN"}},5245:function(e){e.exports={container:"CommentThread_container__Lnd3l",list:"CommentThread_list__7acjP",loading:"CommentThread_loading__K0EYJ",empty:"CommentThread_empty__DuoEJ",form:"CommentThread_form___t0Lp",textarea:"CommentThread_textarea__62jSw",error:"CommentThread_error__bkZvt",submitButton:"CommentThread_submitButton__msIk4",loginPrompt:"CommentThread_loginPrompt__CddXZ"}},1407:function(e){e.exports={container:"DocumentView_container__IlElb",header:"DocumentView_header__uPR63",title:"DocumentView_title__La0ys",description:"DocumentView_description__kC87G",progress:"DocumentView_progress__Fbzt3",progressBar:"DocumentView_progressBar__evjBa",progressFill:"DocumentView_progressFill__mxAGE",progressText:"DocumentView_progressText__nOUx5",content:"DocumentView_content__7StWc",empty:"DocumentView_empty__BEpXH",footer:"DocumentView_footer__URP48",signatureStatus:"DocumentView_signatureStatus__DNq_u",signedStatus:"DocumentView_signedStatus__T3cV_",unsignedStatus:"DocumentView_unsignedStatus__eXtCl",signatureActions:"DocumentView_signatureActions__sHBfU",rejectButton:"DocumentView_rejectButton__qgv5O",signButton:"DocumentView_signButton__fOi0z"}},5985:function(e){e.exports={bar:"InteractionBar_bar__uo6HI",approvalButtons:"InteractionBar_approvalButtons__hZeA6",button:"InteractionBar_button__NB_5N",buttonText:"InteractionBar_buttonText__bL9WD",approveButton:"InteractionBar_approveButton__zMz_v",active:"InteractionBar_active__BDRRz",rejectButton:"InteractionBar_rejectButton__Gi8ll",commentButton:"InteractionBar_commentButton__JRQd0",commentCount:"InteractionBar_commentCount__bCltl"}},2603:function(e){e.exports={card:"ParagraphCard_card__uBsup",content:"ParagraphCard_content__eaie7","type-paragraph":"ParagraphCard_type-paragraph__bxFKy","type-h1":"ParagraphCard_type-h1__9k8_b","type-h2":"ParagraphCard_type-h2__RtjiZ","type-h3":"ParagraphCard_type-h3__empY7","type-h4":"ParagraphCard_type-h4__qQCDV","type-h5":"ParagraphCard_type-h5__QwuaH","type-h6":"ParagraphCard_type-h6__9kcCw",listItem:"ParagraphCard_listItem__3v4w7",bullet:"ParagraphCard_bullet__GJHb1","type-li":"ParagraphCard_type-li__1ytTC",approved:"ParagraphCard_approved__Rrcg3",rejected:"ParagraphCard_rejected__YhGOW",pending:"ParagraphCard_pending__MRFO7","heat-low":"ParagraphCard_heat-low__sXzZb","heat-medium":"ParagraphCard_heat-medium__TE1i4","heat-high":"ParagraphCard_heat-high__F8GRc",adminInfo:"ParagraphCard_adminInfo__qovzU"}},5790:function(e){e.exports={backdrop:"Modal_backdrop__853VI",fadeIn:"Modal_fadeIn__3R_gQ",modal:"Modal_modal__mFu9m",slideUp:"Modal_slideUp__r9dAO",small:"Modal_small__8MSLb",medium:"Modal_medium__taiOz",large:"Modal_large__O7Y_E",header:"Modal_header__2oN_U",title:"Modal_title__zwXCi",closeButton:"Modal_closeButton__mDlnv",content:"Modal_content__bLXKl"}}},function(e){e.O(0,[709,734,577,566,971,117,744],function(){return e(e.s=3107)}),_N_E=e.O()}]);